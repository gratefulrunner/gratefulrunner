import requests
import urllib3
import pandas as pd
import json
import time
import datetime
from datetime import datetime
import urllib3

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

auth_url = "https://www.strava.com/oauth/token"
activites_url = "https://www.strava.com/api/v3/athlete/activities"

#Grabbing all Variables from strava API page
client_secret = '###'
access_token = '###'
refresh_token = '###'
client_id = '###'
ahtlete_id = '###'



#making a request to Strava API for temporary access token. This will get us our activities from the site
payload = {
    'client_id': client_id,
    'client_secret': client_secret,
    'refresh_token': refresh_token,
    'grant_type': "refresh_token",
    'f': 'json'
}

res = requests.post(auth_url, data=payload, verify=False)
print("On a run to get the token...\n")
auth_token_app = res.json()['access_token']

print('Token is:')
print(auth_token_app)

#Making a request to the Strava API for all activity data within the chosen timeframe
header = {'Authorization': 'Bearer ' + auth_token_app}
#choosing timeframe for data
start_range = input('Choose start date (yyyy-mm-dd):' )
end_range = input('Choose end date (yyyy-mm-dd):' )
print('Fetching Runs from '+start_range+' through '+end_range)

#converting input to epoch format for get request
start_epoch = str(datetime.strptime(start_range, '%Y-%m-%d').timestamp())
end_epoch = str(datetime.strptime(end_range, '%Y-%m-%d').timestamp())

param = {'per_page':200, 'page':1, 'before':end_epoch, 'after':start_epoch}
url = "https://www.strava.com/api/v3/athlete/activities"
athlete_dataset = requests.get(url, headers=header
                               ,params=param
                               ).json()

print(athlete_dataset)
